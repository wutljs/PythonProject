# 开发文档

## 需求

通过编写程序模拟红十对局，找出不同牌局形势下红十最佳的玩法。

## 游戏规则

### 游戏分伙规则

玩家中抽到红色10的为一伙,如果某位玩家单独抽到了两张红10，那他将自己一伙。

### 出牌规则

- 扑克牌权重定义规则：大王>小王>红色10>2>A>K>Q>J>黑色10>9>8>7>6>5>4>3。

- 抽到红桃6的玩家具有优先出牌的权力。并从此玩家开始，接下来的玩家依次按顺序出牌。         

  注：在此程序中创建的4个虚拟玩家被分配有编号（0-3，其中的0号为拥有红桃6的玩家），其按0->1->2->3的顺序出牌。

- 相同张数（此处指两种扑克牌的1-4张）的牌之间可以比较大小，不同张数的牌之间一般不可以比较大小。         注：两张红色10大于任何一张单牌。（只有这种情况下才可以两张牌与一张牌比较大小）。

- 当一方的牌都打完了之后，剩下的一方为失败者。         

## 相关数学理论

本需求可以用玩家在不同初始手牌的情况下，在局内的表现以及对局结果三个量来描述。下面将阐述三个量的描述方法及分析方法。

### 初始函数

#### 定义背景

每局的玩家初始条件可由玩家手牌的大小来描述。

#### 表达式

设玩家在开局分到了n张手牌，则
$$
n=\frac{N_{手牌总数}}{N_{玩家人数}}
$$
设$x_i$为玩家手中第i张牌的权重，则牌的平均权重A可以表示为
$$
A=\frac{\sum_{i=0}^{n-1} x_i}{n}
$$

A可用于描述玩家初始手牌大小。

### 表现函数

#### 定义背景

每局玩家的局内表现可以用玩家出局次序和玩家出局后敌方剩余手牌数来描述。

#### 表达式

设玩家在开局分到了n张手牌，则
$$
n=\frac{N_{手牌总数}}{N_{玩家人数}}
$$
设Q代表玩家一句内的表现。若玩家出局越早、出局后敌方手牌剩余越多，Q值越大，则Q函数可以表示为二者组合
$$
Q(T,N_{敌方剩余手牌数})=-\alpha\times T+\beta\times\frac{N_{敌方剩余手牌数}}{N_{敌方人数}}
$$
式中α和β为权重系数，T为玩家第T个出局。归一化处理Q函数，并且使用M来代表该玩家出局后敌方剩余手牌、使用N来代替敌方人数。则Q函数修改为
$$
Q(T,M)=-\alpha\times T+(1-\alpha)\times\frac{M}{N}
$$
#### 性质

Q函数中α、T和M的取值范围应如下
$$
\alpha\in(0,1)
$$

$$
T\in[0,N_{玩家人数}-1]
$$

$$
M\in[0,N\times n]
$$

设$Q_1(T,M)=-\alpha\times T_1+(1-\alpha)\times\frac{M_1}{N}$且$T_1、M_1$为连续型变量，各参数取值范围与Q函数一致。那么$Q_1$函数对应的方程在空间坐标系中为一个倾斜的平面，则$Q_1$函数在某一区间内的最值在边界取得。

那么对于Q函数来说，应有
$$
Q(T,M)_{max}=Q(0,N{\times}n)=n\times(1-\alpha)>0
$$

$$
Q(T,M)_{min}=Q(N_{玩家人数}-1,0)=\alpha{\times}(1-N_{玩家人数})<0
$$

此处可以简单地验证一下。假设在某一四人红十牌局中，两两一伙，扑克牌总数为40。

- 假设α=0.4，则有
  $$
  Q_1(T,M)=-0.4{\times}T+0.3{\times}M
  $$
  且
  $$
  Q_1(T,M)_{max}=10{\times}(1-0.4)=6
  $$

  $$
  Q_1(T,M)_{min}=0.4{\times}(1-4)=-1.2
  $$

  编写如下python程序来进行测试Q函数

  ```python
  import numpy as np
  import matplotlib.pyplot as plt
  
  
  # 定义函数
  def f(x, y):
      return -0.4 * x + 0.3 * y
  
  
  # 生成x和y的数据范围
  x = np.linspace(0, 3, 100)
  y = np.linspace(0, 20, 100)
  
  # 创建网格点坐标矩阵
  X, Y = np.meshgrid(x, y)
  
  # 计算函数值
  Z = f(X, Y)
  
  # 创建3D图形对象
  fig = plt.figure()
  ax = fig.add_subplot(111, projection='3d')
  
  # 绘制3D图形
  ax.plot_surface(X, Y, Z, cmap='RdYlBu')
  
  # 设置坐标轴标签
  ax.set_xlabel('T')
  ax.set_ylabel('M')
  ax.set_zlabel('Q(T,M)')
  
  # 设置图形标题
  ax.set_title('3D Plot of Q(T, M) = -0.4T + 0.3M')
  
  # 显示图形
  plt.show()
  
  ```
  

程序运行结果如图所示![](C:\Users\34803\PycharmProjects\pythonProject3\hongshi\图片\α=0.4.png)

至此Q函数的数学性质得到验证。

- 假设α=0.8，同理可证Q函数具有上述讨论中的数学性质。



## 算法设计

### 对局流程

见“hongshi\流程设计\红十对战设计.pdf”。

### 玩家出牌

- 玩家自由出牌

  小牌先出，多张重复的牌先出。

- 玩家接牌

  刚大于所接牌的牌先出。
